<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="NeuroMate.MainPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:skia="clr-namespace:SkiaSharp.Extended.UI.Controls;assembly=SkiaSharp.Extended.UI"
             Title="NeuroMate"
             BackgroundColor="{StaticResource PageBackground}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Nowoczesny header z gradientem -->
        <Frame Grid.Row="0" Style="{StaticResource ElevatedCard}" 
               Margin="16,24,16,12"
               Background="{StaticResource CardGradient}">
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Awatar z nowym designem -->
                <Frame Grid.Column="0" Style="{StaticResource AvatarFrame}" 
                       WidthRequest="70" HeightRequest="70">
                    <skia:SKLottieView x:Name="MainAvatarLottie"
                                       Source="turtle.json"
                                       RepeatCount="-1"
                                       IsAnimationEnabled="True"
                                       WidthRequest="54"
                                       HeightRequest="54">
                        <skia:SKLottieView.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnAvatarTapped" />
                        </skia:SKLottieView.GestureRecognizers>
                    </skia:SKLottieView>
                </Frame>

                <!-- Informacje powitalne -->
                <StackLayout Grid.Column="1" VerticalOptions="Center" Spacing="4">
                    <Label Text="NeuroMate 🧠"
                           Style="{StaticResource TitleStyle}" 
                           FontSize="{OnPlatform iOS=20, Android=20, WinUI=24}" />
                    <Label x:Name="StatusLabel"
                           Text="Gotowy do treningu!"
                           Style="{StaticResource SubtitleStyle}"
                           FontSize="{OnPlatform iOS=14, Android=14, WinUI=16}" />
                </StackLayout>

                <!-- NeuroScore z gradientem -->
                <Frame Grid.Column="2" 
                       Background="{StaticResource AccentGradient}"
                       CornerRadius="20"
                       Padding="16,12"
                       HasShadow="True">
                    <StackLayout Spacing="2" HorizontalOptions="Center">
                        <Label Text="NeuroScore" 
                               FontSize="11" 
                               TextColor="{StaticResource TextLight}" 
                               HorizontalOptions="Center" />
                        <Label x:Name="NeuroScoreLabel" 
                               Text="85"
                               FontSize="22" 
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextLight}" 
                               HorizontalOptions="Center" />
                    </StackLayout>
                </Frame>
            </Grid>
        </Frame>

        <!-- Główna zawartość z przewijaniem -->
        <ScrollView Grid.Row="1" Padding="16,0">
            <StackLayout Spacing="20">

                <!-- Dashboard z responsywnymi kartami -->
                <StackLayout Spacing="12">
                    <!-- Karta koncentracji -->
                    <Frame Style="{StaticResource StatCard}">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Text="🎯" 
                                   FontSize="{OnPlatform iOS=20, Android=20, WinUI=24}" 
                                   VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Koncentracja" 
                                       Style="{StaticResource BodyLabel}"
                                       FontAttributes="Bold"
                                       FontSize="{OnPlatform iOS=14, Android=14, WinUI=16}" />
                                <Label x:Name="FocusLevelLabel" 
                                       Text="Wysoka" 
                                       Style="{StaticResource TitleStyle}"
                                       FontSize="18"
                                       TextColor="{StaticResource Success}" />
                            </StackLayout>
                            <ProgressBar Grid.Column="2" 
                                         x:Name="FocusProgressBar" 
                                         Progress="0.85" 
                                         ProgressColor="{StaticResource Success}"
                                         WidthRequest="60"
                                         VerticalOptions="Center" />
                        </Grid>
                    </Frame>

                    <!-- Karta czasu pracy -->
                    <Frame Style="{StaticResource StatCard}">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Text="⏰" 
                                   FontSize="{OnPlatform iOS=20, Android=20, WinUI=24}" 
                                   VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Czas pracy" 
                                       Style="{StaticResource BodyLabel}"
                                       FontAttributes="Bold"
                                       FontSize="{OnPlatform iOS=14, Android=14, WinUI=16}" />
                                <Label x:Name="WorkTimeLabel" 
                                       Text="2h 15m" 
                                       Style="{StaticResource TitleStyle}"
                                       FontSize="18" />
                            </StackLayout>
                            <Label Grid.Column="2"
                                   x:Name="WorkStatusLabel" 
                                   Text="W porządku" 
                                   Style="{StaticResource CaptionLabel}"
                                   FontSize="11"
                                   TextColor="{StaticResource Success}"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Frame>

                    <!-- Karta snu -->
                    <Frame Style="{StaticResource StatCard}">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Text="😴" 
                                   FontSize="{OnPlatform iOS=20, Android=20, WinUI=24}" 
                                   VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Jakość snu" 
                                       Style="{StaticResource BodyLabel}"
                                       FontAttributes="Bold"
                                       FontSize="{OnPlatform iOS=14, Android=14, WinUI=16}" />
                                <Label x:Name="SleepScoreLabel" 
                                       Text="72/100" 
                                       Style="{StaticResource TitleStyle}"
                                       FontSize="18"
                                       TextColor="{StaticResource Info}" />
                            </StackLayout>
                            <Label Grid.Column="2"
                                   Text="7h 23m" 
                                   Style="{StaticResource CaptionLabel}"
                                   FontSize="11"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Frame>

                    <!-- Karta stresu -->
                    <Frame Style="{StaticResource StatCard}">
                        <Grid ColumnSpacing="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            
                            <Label Grid.Column="0" Text="💗" 
                                   FontSize="{OnPlatform iOS=20, Android=20, WinUI=24}" 
                                   VerticalOptions="Center" />
                            <StackLayout Grid.Column="1" Spacing="4">
                                <Label Text="Stres (HRV)" 
                                       Style="{StaticResource BodyLabel}"
                                       FontAttributes="Bold"
                                       FontSize="{OnPlatform iOS=14, Android=14, WinUI=16}" />
                                <Label x:Name="StressLevelLabel" 
                                       Text="Niski" 
                                       Style="{StaticResource TitleStyle}"
                                       FontSize="18"
                                       TextColor="{StaticResource Success}" />
                            </StackLayout>
                            <Label Grid.Column="2"
                                   Text="65 ms" 
                                   Style="{StaticResource CaptionLabel}"
                                   FontSize="11"
                                   VerticalOptions="Center" />
                        </Grid>
                    </Frame>
                </StackLayout>

                <!-- Sekcja szybkich akcji -->
                <Frame Style="{StaticResource ModernCard}">
                    <StackLayout Spacing="16">
                        <Label Text="⚡ Szybkie akcje" 
                               Style="{StaticResource TitleStyle}"
                               FontSize="{OnPlatform iOS=18, Android=18, WinUI=22}" />
                        
                        <StackLayout Spacing="12">
                            <Button Text="🎨 Test Stroop"
                                    Style="{StaticResource PrimaryButton}"
                                    Clicked="OnStroopTestClicked" />
                            
                            <Button Text="⚡ Reakcja (PVT)"
                                    Style="{StaticResource AccentButton}"
                                    Clicked="OnPvtTestClicked" />
                            
                            <Button Text="🔄 Task Switch"
                                    Style="{StaticResource SecondaryButton}"
                                    Clicked="OnTaskSwitchClicked" />
                            
                            <Button Text="📊 Podsumowanie"
                                    Style="{StaticResource OutlineButton}"
                                    Clicked="OnSummaryClicked" />

                            <!-- Avatar toggle button -->
                            <Button Text="🐢 Pokaż/Ukryj Avatara"
                                    Style="{StaticResource SecondaryButton}"
                                    Clicked="OnToggleAvatarClicked" />
                        </StackLayout>
                    </StackLayout>
                </Frame>

                <!-- Sekcja rekomendacji AI -->
                <Frame Style="{StaticResource ModernCard}">
                    <StackLayout Spacing="16">
                        <Label Text="🤖 Rekomendacje AI" 
                               Style="{StaticResource TitleStyle}"
                               FontSize="{OnPlatform iOS=18, Android=18, WinUI=22}" />
                        
                        <Frame BackgroundColor="{StaticResource SurfaceBackground}"
                               CornerRadius="12"
                               Padding="16"
                               BorderColor="Transparent">
                            <StackLayout Spacing="12">
                                <Label x:Name="AIRecommendationLabel"
                                       Text="Na podstawie Twoich ostatnich wyników sugeruję skupienie się na ćwiczeniach koncentracji. Twój wynik w teście Stroop można poprawić!"
                                       Style="{StaticResource BodyLabel}"
                                       FontSize="{OnPlatform iOS=14, Android=14, WinUI=15}"
                                       LineBreakMode="WordWrap" />
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                                    <Button Grid.Column="0"
                                            Text="🎯 Zacznij"
                                            Style="{StaticResource PrimaryButton}"
                                            Clicked="OnStartRecommendationClicked" />
                                    
                                    <Button Grid.Column="1"
                                            Text="📈 Więcej"
                                            Style="{StaticResource OutlineButton}"
                                            Clicked="OnMoreRecommendationsClicked" />
                                </Grid>
                            </StackLayout>
                        </Frame>
                    </StackLayout>
                </Frame>

                <!-- Odstęp na dole -->
                <BoxView HeightRequest="20" Color="Transparent" />
            </StackLayout>
        </ScrollView>

        <!-- Okno dialogowe avatara -->
        <Grid x:Name="AvatarDialogOverlay" 
              Style="{StaticResource DialogOverlay}"
              Grid.RowSpan="2">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnDialogOverlayTapped" />
            </Grid.GestureRecognizers>

            <!-- Okno dialogowe z avatarem -->
            <Frame x:Name="AvatarDialogCard" Style="{StaticResource DialogCard}">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer />
                </Frame.GestureRecognizers>
                
                <StackLayout Spacing="20">
                    <!-- Avatar i animacja -->
                    <Grid>
                        <Frame Style="{StaticResource AvatarFrame}" 
                               WidthRequest="80" 
                               HeightRequest="80"
                               HorizontalOptions="Center">
                            <skia:SKLottieView x:Name="DialogAvatarLottie"
                                               Source="turtle.json"
                                               RepeatCount="-1"
                                               IsAnimationEnabled="True"
                                               WidthRequest="64"
                                               HeightRequest="64" />
                        </Frame>
                        
                        <!-- Indicator mówiącej postaci -->
                        <Ellipse x:Name="SpeechIndicator"
                                 Fill="{StaticResource Success}"
                                 WidthRequest="16"
                                 HeightRequest="16"
                                 HorizontalOptions="End"
                                 VerticalOptions="Start"
                                 Margin="8"
                                 Opacity="0.8" />
                    </Grid>

                    <!-- Imię assistenta -->
                    <Label Text="NeuroMate Assistant 🧠"
                           Style="{StaticResource TitleStyle}"
                           FontSize="20"
                           HorizontalOptions="Center"
                           TextColor="{StaticResource Primary}" />

                    <!-- Wiadomość od avatara -->
                    <Frame BackgroundColor="{StaticResource SurfaceBackground}"
                           CornerRadius="16"
                           Padding="16"
                           BorderColor="Transparent">
                        <Label x:Name="AvatarMessageLabel"
                               Text="Cześć! Jestem twoim asystentem neurokognitywnym. Mogę pomóc Ci w treningu mózgu i monitorowaniu wydajności!"
                               Style="{StaticResource BodyLabel}"
                               FontSize="{OnPlatform iOS=14, Android=14, WinUI=15}"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"
                               LineBreakMode="WordWrap" />
                    </Frame>

                    <!-- Przyciski akcji -->
                    <StackLayout Spacing="12">
                        <Button x:Name="StartTrainingButton"
                                Text="🎯 Rozpocznij trening"
                                Style="{StaticResource PrimaryButton}"
                                Clicked="OnDialogStartTrainingClicked" />
                        
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <Button Grid.Column="0"
                                    x:Name="ShowStatsButton"
                                    Text="📊 Statystyki"
                                    Style="{StaticResource SecondaryButton}"
                                    Clicked="OnDialogShowStatsClicked" />
                            
                            <Button Grid.Column="1"
                                    x:Name="SettingsButton"
                                    Text="⚙️ Ustawienia"
                                    Style="{StaticResource OutlineButton}"
                                    Clicked="OnDialogSettingsClicked" />
                        </Grid>
                    </StackLayout>

                    <!-- Przycisk zamknij -->
                    <Button Text="✕ Zamknij"
                            x:Name="CloseDialogButton"
                            Style="{StaticResource OutlineButton}"
                            TextColor="{StaticResource TextSecondary}"
                            BorderColor="{StaticResource BorderMedium}"
                            Clicked="OnCloseDialogClicked"
                            FontSize="14"
                            Padding="12,8" />
                </StackLayout>
            </Frame>
        </Grid>
    </Grid>

</ContentPage>