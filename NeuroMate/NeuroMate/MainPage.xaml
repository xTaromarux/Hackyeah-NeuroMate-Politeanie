<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:NeuroMate.ViewModels"
             x:Class="NeuroMate.MainPage"
             Title="NeuroMate"
             BackgroundColor="{StaticResource PageBackground}">

    <ContentPage.BindingContext>
        <viewModels:MainViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <Grid Padding="20" RowSpacing="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Header z awatarem -->
            <Frame Grid.Row="0" Style="{StaticResource CardFrame}" Padding="20">
                <Grid ColumnSpacing="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Awatar -->
                    <Frame Grid.Column="0" 
                           WidthRequest="70" 
                           HeightRequest="70" 
                           CornerRadius="35"
                           Padding="0"
                           BackgroundColor="{StaticResource PrimaryLight}">
                        <Label Text="🤖" 
                               FontSize="35" 
                               HorizontalTextAlignment="Center" 
                               VerticalTextAlignment="Center" />
                    </Frame>

                    <!-- Powitanie i hint -->
                    <StackLayout Grid.Column="1" Spacing="5">
                        <Label Text="Cześć! 👋" 
                               Style="{StaticResource SectionTitle}" />
                        <Label Text="{Binding AssistantHint}" 
                               Style="{StaticResource Subtitle}"
                               LineBreakMode="WordWrap" />
                    </StackLayout>

                    <!-- Status badge -->
                    <Frame Grid.Column="2" 
                           BackgroundColor="{StaticResource Success}"
                           CornerRadius="12"
                           Padding="10,5"
                           HasShadow="False">
                        <Label Text="Aktywny" 
                               TextColor="White" 
                               FontSize="12"
                               FontAttributes="Bold" />
                    </Frame>
                </Grid>
            </Frame>

            <!-- Neuro-Score i metryki główne -->
            <Frame Grid.Row="1" Style="{StaticResource CardFrame}">
                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Neuro-Score -->
                    <StackLayout Grid.Column="0" Spacing="5">
                        <Label Text="Neuro-Score" 
                               Style="{StaticResource StatDescription}" />
                        <Label Text="{Binding NeuroScore}" 
                               Style="{StaticResource StatLabel}"
                               TextColor="{StaticResource Success}" />
                        <ProgressBar Progress="{Binding NeuroScore}"
                                     ProgressColor="{StaticResource Success}"
                                     BackgroundColor="{StaticResource Gray200}"
                                     HeightRequest="8" />
                    </StackLayout>

                    <!-- HRV -->
                    <StackLayout Grid.Column="1" Spacing="5">
                        <Label Text="HRV" 
                               Style="{StaticResource StatDescription}" />
                        <Label Text="{Binding Hrv}" 
                               Style="{StaticResource StatLabel}"
                               TextColor="{StaticResource Info}" />
                        <Label Text="ms" 
                               Style="{StaticResource StatDescription}"
                               HorizontalTextAlignment="Center" />
                    </StackLayout>

                    <!-- Czas bez przerwy -->
                    <StackLayout Grid.Column="2" Spacing="5">
                        <Label Text="Bez przerwy" 
                               Style="{StaticResource StatDescription}" />
                        <Label Text="{Binding MinutesNoBreak}" 
                               Style="{StaticResource StatLabel}"
                               TextColor="{StaticResource Warning}" />
                        <Label Text="minut" 
                               Style="{StaticResource StatDescription}"
                               HorizontalTextAlignment="Center" />
                    </StackLayout>
                </Grid>
            </Frame>

            <!-- Cel dnia -->
            <Frame Grid.Row="2" Style="{StaticResource CardFrame}">
                <StackLayout Spacing="15">
                    <Label Text="Wybierz swój cel na dziś" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <Grid ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <Button Grid.Row="0" Grid.Column="0"
                                Text="🎯 Koncentracja"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding SelectGoalCommand}"
                                CommandParameter="focus" />

                        <Button Grid.Row="0" Grid.Column="1"
                                Text="😌 Redukcja stresu"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding SelectGoalCommand}"
                                CommandParameter="stress" />

                        <Button Grid.Row="1" Grid.Column="0"
                                Text="⚡ Energia"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding SelectGoalCommand}"
                                CommandParameter="energy" />

                        <Button Grid.Row="1" Grid.Column="1"
                                Text="🧠 Pamięć"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding SelectGoalCommand}"
                                CommandParameter="memory" />
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- Gra PVT -->
            <Frame Grid.Row="3" Style="{StaticResource CardFrame}">
                <StackLayout Spacing="15">
                    <Label Text="Test Czasu Reakcji (PVT)" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <!-- Status gry -->
                    <Frame BackgroundColor="{StaticResource PrimaryLight}"
                           CornerRadius="15"
                           Padding="20"
                           HasShadow="False">
                        <StackLayout Spacing="10">
                            <Label Text="{Binding PvtStateText}" 
                                   Style="{StaticResource SectionTitle}"
                                   HorizontalTextAlignment="Center"
                                   TextColor="{StaticResource Primary}" />
                            
                            <Grid ColumnSpacing="20" IsVisible="{Binding HasLastReaction}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackLayout Grid.Column="0">
                                    <Label Text="Ostatni" Style="{StaticResource StatDescription}" />
                                    <Label Text="{Binding LastReactionMs}" Style="{StaticResource StatLabel}" FontSize="20" />
                                    <Label Text="ms" Style="{StaticResource StatDescription}" />
                                </StackLayout>

                                <StackLayout Grid.Column="1">
                                    <Label Text="Najlepszy" Style="{StaticResource StatDescription}" />
                                    <Label Text="{Binding BestReactionMs}" Style="{StaticResource StatLabel}" FontSize="20" />
                                    <Label Text="ms" Style="{StaticResource StatDescription}" />
                                </StackLayout>

                                <StackLayout Grid.Column="2">
                                    <Label Text="Średni" Style="{StaticResource StatDescription}" />
                                    <Label Text="{Binding AvgReactionMs}" Style="{StaticResource StatLabel}" FontSize="20" />
                                    <Label Text="ms" Style="{StaticResource StatDescription}" />
                                </StackLayout>
                            </Grid>
                        </StackLayout>
                    </Frame>

                    <Button Text="{Binding PvtButtonText}"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding TogglePvtCommand}" />
                </StackLayout>
            </Frame>

            <!-- Akcje szybkie -->
            <Frame Grid.Row="4" Style="{StaticResource CardFrame}">
                <StackLayout Spacing="15">
                    <Label Text="Szybkie akcje" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <Grid ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Text="🚀 Mikro-interwencja"
                                Style="{StaticResource SecondaryButton}"
                                Command="{Binding StartMicroInterventionCommand}" />

                        <Button Grid.Column="1"
                                Text="📅 Dodaj przerwę"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding AddCalendarBreakCommand}" />
                    </Grid>

                    <Grid ColumnSpacing="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                Text="📊 Import CSV"
                                Style="{StaticResource OutlineButton}"
                                Command="{Binding ImportCsvCommand}" />

                        <Button Grid.Column="1"
                                Text="🔄 Reset danych"
                                Style="{StaticResource OutlineButton}"
                                TextColor="{StaticResource Error}"
                                BorderColor="{StaticResource Error}"
                                Command="{Binding ResetDataCommand}" />
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- Trend tygodniowy -->
            <Frame Grid.Row="5" Style="{StaticResource CardFrame}">
                <StackLayout Spacing="15">
                    <Label Text="Trend tygodniowy" 
                           Style="{StaticResource SectionTitle}" />
                    
                    <!-- Prosty wykres słupkowy -->
                    <Grid ColumnSpacing="5" HeightRequest="120">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Pon -->
                        <StackLayout Grid.Column="0" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[0].Score}" 
                                   BackgroundColor="{StaticResource Primary}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[0].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Wt -->
                        <StackLayout Grid.Column="1" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[1].Score}" 
                                   BackgroundColor="{StaticResource Primary}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[1].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Śr -->
                        <StackLayout Grid.Column="2" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[2].Score}" 
                                   BackgroundColor="{StaticResource Primary}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[2].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Czw -->
                        <StackLayout Grid.Column="3" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[3].Score}" 
                                   BackgroundColor="{StaticResource Success}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[3].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Pt -->
                        <StackLayout Grid.Column="4" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[4].Score}" 
                                   BackgroundColor="{StaticResource Success}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[4].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Sob -->
                        <StackLayout Grid.Column="5" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[5].Score}" 
                                   BackgroundColor="{StaticResource Primary}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[5].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>

                        <!-- Ndz -->
                        <StackLayout Grid.Column="6" Spacing="5">
                            <Frame HeightRequest="{Binding TrendPoints[6].Score}" 
                                   BackgroundColor="{StaticResource Primary}"
                                   CornerRadius="3"
                                   Padding="0"
                                   VerticalOptions="End" />
                            <Label Text="{Binding TrendPoints[6].Day}" 
                                   Style="{StaticResource StatDescription}"
                                   HorizontalTextAlignment="Center" />
                        </StackLayout>
                    </Grid>

                    <Label Text="Najlepsze dni: Pt (78pts), Śr (75pts)" 
                           Style="{StaticResource Subtitle}"
                           HorizontalTextAlignment="Center" />
                </StackLayout>
            </Frame>
        </Grid>
    </ScrollView>
</ContentPage>